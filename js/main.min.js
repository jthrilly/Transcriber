var Transcriber=function(t){function e(t){return minutes=Math.floor(t/60),minutes=minutes>=10?minutes:"0"+minutes,t=Math.floor(t%60),t=t>=10?t:"0"+t,minutes+":"+t}function i(t){return!isNaN(parseFloat(t))&&isFinite(t)}var n=this,a=!1,r=document.getElementById("audio-player"),o=[],u=!1,c,s,p={debug:!0,participants:["Participant 1","Participant 2"],audio:""},l=t||p;this.init=function(){$("#selectedFile").hide(),$(".open-music").on("click",function(){$("#selectedFile").trigger("click")}),$("#speedSlider").slider({min:.1,max:2,step:.1,value:1,tooltip:"hide"}).on("slide",function(t){i(t.value[0])&&n.adjustPlaySpeed(t.value[0])}),$(".time").html("00:00/"+e(r.duration)),$("#audio-player").bind("timeupdate",function(){var t=e(r.currentTime);$(".time").html(t+"/"+e(r.duration))}),$("#audio-player").bind("durationchange",function(){var t=e(r.currentTime);$(".time").html(t+"/"+e(r.duration))}),$.each(l.participants,function(t,e){$(".participant-buttons").append('<button class="btn btn-primary btn-block individual">'+e+"</button>"),$(".radio").append('<label><input type="radio" name="participantRadio" value="'+e+'">'+e+"</label>")}),$("input:radio:first").prop("checked",!0),$(".individual:first").addClass("active-individual");var t=$("footer").outerHeight(),u=$("nav").outerHeight()+15;$("body").css({marginBottom:t,marginTop:u}),$(document).on("keydown",function(t){8!==t.which||$(t.target).is("input, textarea, div")||t.preventDefault(),9==t.which&&(t.preventDefault(),n.toggleParticipant()),32==t.which&&t.shiftKey&&(t.preventDefault(),t.stopImmediatePropagation(),n.togglePlay())}),$(document.body).on("click",".list-group-item",function(){var t=$(this).data("index"),e=o[t].startTime;n.seekTo(e)}),$(document).on("keypress",function(t){60==t.which&&(t.preventDefault(),t.stopImmediatePropagation(),n.Rewind()),62==t.which&&(t.preventDefault(),t.stopImmediatePropagation(),n.Forward())}),$(document.body).on("keypress",".utterance",function(){if(13==event.which){event.preventDefault(),n.updateUtterance($(this)),$(".current-utterance").focus();var t=$(this);$(t).parent().transition({background:"rgb(232, 255, 235)"},800,"ease"),s=setTimeout(function(){$(t).parent().transition({background:"#ffffff"},1800,"ease")},1500)}}),$(".current-utterance").keypress(function(t){13==t.which&&(t.preventDefault(),t.stopImmediatePropagation(),$("form").submit())}).focus(),$("form").on("submit",function(t){t.preventDefault(),t.stopImmediatePropagation();var e={};e.participant={},e.participant=$("input[name=participantRadio]:checked").val(),e.utterance={},e.utterance=$(".current-utterance").val(),e.startTime={},c=c||0,e.startTime=c,e.submitTime={},e.submitTime=r.currentTime,n.addUtterance(e),c=r.currentTime,$(".current-utterance").val(""),n.toggleParticipant()}),a=!0},this.toggleParticipant=function(){$('input[type="radio"]').not(":checked").prop("checked",!0),$(".individual").toggleClass("active-individual")},this.getInterviewData=function(){return o},this.resetInterview=function(){currentTime=0,o=[],c=0,n.Stop(),r.src=null,$(".time").html("00:00/00:00"),$(".list-group").empty(),$(".current-utterance").focus()},this.addUtterance=function(t){o.push(t);var i=o.length-1,n=$('<a class="list-group-item" style="opacity:0;position:relative;top:200px" data-index="'+i+'">').html('<h4 class="list-group-item-heading">'+t.participant+" <small>"+e(t.startTime)+"-"+e(t.submitTime)+'</small></h4><div contenteditable class="utterance">'+t.utterance+"</div></a>");$(".list-group").append(n),n.transition({opacity:1,top:0,background:"rgb(255, 249, 182)"},800,"ease"),$("body, html").stop().animate({scrollTop:n.offset().top},1500),s=setTimeout(function(){n.transition({background:"#fff"},1800,"ease")},1500)},this.updateUtterance=function(t){o[$(t).parent().data("index")].utterance=$(t).html()},this.removeUtterance=function(t){},this.loadAudio=function(t){n.resetInterview();var i=(window.webkitURL?webkitURL:URL).createObjectURL(t[0]);r.src=i,r.load();var a=e(r.currentTime);$(".current-utterance").focus()},this.togglePlay=function(){u?n.Pause():n.Play()},this.adjustPlaySpeed=function(t){r.playbackRate=t},this.Play=function(){console.log("playing"),r.play(),$(".play span").removeClass("glyphicon-play").addClass("glyphicon-pause"),u=!0},this.Stop=function(){console.log("stopping"),r.pause(),r.currentTime=0,u=!1},this.Pause=function(){r.pause(),$(".play span").removeClass("glyphicon-pause").addClass("glyphicon-play"),u=!1},this.Forward=function(){r.currentTime+=5},this.Rewind=function(){r.currentTime-=5},this.seekTo=function(t){r.currentTime=t},n.init()};window.onload=function(){window.transcriber=new Transcriber({debug:!0,participants:["Joshua Melville","Martin Farran"],audio:"test.wav"})};
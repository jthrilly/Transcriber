var Transcriber=function(t){function e(t){return minutes=Math.floor(t/60),minutes=minutes>=10?minutes:"0"+minutes,t=Math.floor(t%60),t=t>=10?t:"0"+t,minutes+":"+t}var i=this,n=!1,a=document.getElementById("audio-player"),o=[],r=!1,u,c,s={debug:!0,participants:["Participant 1","Participant 2"],audio:""},p=t||s;this.init=function(){$(".time").html("00:00/"+e(a.duration)),$("#audio-player").bind("timeupdate",function(){var t=e(a.currentTime);$(".time").html(t+"/"+e(a.duration))}),$.each(p.participants,function(t,e){$(".radio").append('<label><input type="radio" name="participantRadio" value="'+e+'">'+e+"</label>")}),$("input:radio:first").prop("checked",!0);var t=$("footer").outerHeight(),r=$("nav").outerHeight()+15;$("body").css({marginBottom:t,marginTop:r}),$(document).on("keydown",function(t){8!==t.which||$(t.target).is("input, textarea, div")||t.preventDefault(),9==t.which&&(t.preventDefault(),$('input[type="radio"]').not(":checked").prop("checked",!0)),32==t.which&&t.shiftKey&&(t.preventDefault(),t.stopImmediatePropagation(),i.togglePlay())}),$(document.body).on("click",".list-group-item",function(){var t=$(this).data("index"),e=o[t].startTime;i.seekTo(e)}),$(document).on("keypress",function(t){60==t.which&&(t.preventDefault(),t.stopImmediatePropagation(),i.Rewind()),62==t.which&&(t.preventDefault(),t.stopImmediatePropagation(),i.Forward())}),$(document.body).on("keypress",".utterance",function(){if(13==event.which){event.preventDefault(),i.updateUtterance($(this)),$(".current-utterance").focus();var t=$(this);$(t).parent().transition({background:"rgb(232, 255, 235)"},800,"ease"),c=setTimeout(function(){$(t).parent().transition({background:"#f8f8f8"},1800,"ease")},1500)}}),$(".current-utterance").keypress(function(t){13==t.which&&(t.preventDefault(),t.stopImmediatePropagation(),$("form").submit())}).focus(),$("form").on("submit",function(t){t.preventDefault(),t.stopImmediatePropagation();var e={};e.participant={},e.participant=$("input[name=participantRadio]:checked").val(),e.utterance={},e.utterance=$(".current-utterance").val(),e.startTime={},u=u||0,e.startTime=u,e.submitTime={},e.submitTime=a.currentTime,i.addUtterance(e),u=a.currentTime,$(".current-utterance").val(""),$('input[type="radio"]').not(":checked").prop("checked",!0)}),n=!0},this.getInterviewData=function(){return o},this.addUtterance=function(t){o.push(t);var i=o.length-1,n=$('<a class="list-group-item" style="opacity:0;position:relative;top:200px" data-index="'+i+'">').html('<h4 class="list-group-item-heading">'+t.participant+" <small>"+e(t.startTime)+"-"+e(t.submitTime)+'</small></h4><div contenteditable class="utterance">'+t.utterance+"</div></a>");$(".list-group").append(n),n.transition({opacity:1,top:0,background:"rgb(232, 255, 235)"},800,"ease"),$("body, html").stop().animate({scrollTop:n.offset().top},1500),c=setTimeout(function(){n.transition({background:"#f8f8f8"},1800,"ease")},1500)},this.updateUtterance=function(t){o[$(t).parent().data("index")].utterance=$(t).html()},this.removeUtterance=function(t){},this.loadAudio=function(t){},this.togglePlay=function(){r?i.Pause():i.Play()},this.Play=function(){console.log("playing"),a.play(),$(".play span").removeClass("glyphicon-play").addClass("glyphicon-pause"),r=!0},this.Stop=function(){console.log("stopping"),a.pause(),a.currentTime=0,r=!1},this.Pause=function(){a.pause(),$(".play span").removeClass("glyphicon-pause").addClass("glyphicon-play"),r=!1},this.Forward=function(){a.currentTime+=5},this.Rewind=function(){a.currentTime-=5},this.seekTo=function(t){a.currentTime=t},i.init()};window.onload=function(){window.transcriber=new Transcriber({debug:!0,participants:["Joshua Melville","Martin Farran"],audio:"test.wav"})};